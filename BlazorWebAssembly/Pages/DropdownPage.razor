@page "/dropdown"

@inject IAPICallService APICallService
@inject IJSRuntime JS
@attribute [StreamRendering(true)]

<head>
	<script>
		window.clearSelect = function (elename) {
			document.getElementById(elename).value = "0";
		}
	</script>
</head>

<h2>Dropdown Page</h2>
<br>
<br>
<div>
	<h3>Single select dropdown</h3>
	<select @bind="@selectedCompanyCIF">
		<option disabled selected>-- Select a company --</option>
		@foreach(Company comp in companies)
		{
			<option value="@comp.companyCIF">@comp.companyName</option>
		}
	</select>
	<br>
	<br>
	<Button Color="ButtonColor.Primary" @onclick="ShowDialog">See selected</Button>
</div>

<br>
<br>

<div>
	<h3>Multiple select</h3>
	<select id = "multi_select" multiple class="form-control" @onchange="HandleSelectionChange" style="height:500px">
		@foreach (var comp in companies)
		{
			<option value="@comp.companyCIF">@comp.companyName</option>
		}
	</select>
	<br>
	<Button Color="ButtonColor.Primary" @onclick="ShowDialogMulti">Show Selected</Button>
	<Button Color="ButtonColor.Secondary" @onclick="async () => 
	{
		SelectedCIF.Clear();
		SelectedCompanies.Clear();

		//call JS function
	}">Clear</Button>
</div>


<Dialog Title="Selected Company" Opened="showDialog" CloseButtonClicked="() => showDialog = false">
	<BodyContent>
		@selectedCompany
	</BodyContent>
</Dialog>

<Dialog Title="Selected Companies" Opened="showDialog2" CloseButtonClicked="() => showDialog2 = false">
	<BodyContent>
		@foreach(var comp in SelectedCompanies)
		{
			<p>@comp</p>
		}
	</BodyContent>
</Dialog>

@code {
	Company[] companies = Array.Empty<Company>();
	string selectedCompanyCIF;
	bool showDialog = false;
	bool showDialog2 = false;

	Company selectedCompany;

	protected override async Task OnInitializedAsync()
	{
		companies = await APICallService.getAllCompanies();
	}

	public async Task ShowDialog()
	{
		selectedCompany = await APICallService.GetCompany(selectedCompanyCIF);
		showDialog = true;
	}

	List<string> SelectedCIF = new List<string>();
	List<Company> SelectedCompanies = new List<Company>();

	public async Task HandleSelectionChange(ChangeEventArgs e)
	{
		var selectedValues = ((IEnumerable<string>)e.Value).ToList();

		SelectedCIF = selectedValues;
	}

	public async Task ShowDialogMulti()
	{
		SelectedCompanies.Clear();

		foreach(var CIF in SelectedCIF)
		{
			SelectedCompanies.Add(await APICallService.GetCompany(CIF));
		}

		showDialog2 = true;
	}
}
