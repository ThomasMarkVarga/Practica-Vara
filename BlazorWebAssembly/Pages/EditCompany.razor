@page "/editcompany/{CIF}"

<h3>Edit @company.companyName</h3>

<EditForm Model="company" OnSubmit="HandleSubmit">
    <label>CIF</label>
    <InputText @bind-Value="company.companyCIF">@company.companyCIF</InputText>
    <br>

    <label>Name</label>
    <InputText @bind-Value="company.companyName">@company.companyName</InputText>
    <br>

    <label>Address</label>
    <InputText @bind-Value="company.companyAddress">@company.companyAddress</InputText>
    <br>

    <label>County</label>
    <InputText @bind-Value="company.companyCounty">@company.companyCounty</InputText>
    <br>

    <label>Phone</label>
    <InputText @bind-Value="company.companyPhone">@company.companyPhone</InputText>
    <br>

    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@code {
    [Parameter]
    public string CIF { get; set; }

    Company company = new Company();

    protected override async Task OnInitializedAsync()
    {
        HttpClient client = new HttpClient();
        client.DefaultRequestHeaders.Accept.Add(new System.Net.Http.Headers.MediaTypeWithQualityHeaderValue("application/json"));
        HttpResponseMessage response = await client.GetAsync("https://localhost:7051/GetCompany?CIF=" + CIF);
        string contentString = await response.Content.ReadAsStringAsync();
        company = JsonConvert.DeserializeObject<Company>(contentString);
    }

    async Task HandleSubmit()
    {
        HttpClient client = new HttpClient();
        client.DefaultRequestHeaders.Accept.Add(new System.Net.Http.Headers.MediaTypeWithQualityHeaderValue("application/json"));
        
        HttpRequestMessage request = new HttpRequestMessage
            {
                Method = HttpMethod.Put,
                RequestUri = new Uri("https://localhost:7051/UpdateCompany?CIF=" + CIF + "&newCIF=" + company.companyCIF + "&newName=" + company.companyName + "&newAddress=" + company.companyAddress + "&newCounty=" + company.companyCounty + "&newPhone=" + company.companyPhone)
            };
        await client.SendAsync(request);
    }
}
